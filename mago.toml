# Mago configuration for WordPress Coding Standards compliance
# https://github.com/carthage-software/mago
#
# Mago replaces PHPCS as the primary linting and formatting tool.
# Rules that conflict with WordPress PHP conventions are disabled below.

php-version = "8.3"

[source]
# Plugin source code to lint, format, and analyze
paths = ["admin", "includes", "public", "documentate.php", "uninstall.php"]

# Vendor dependencies parsed for type context only (symbols, types, classes);
# these files are NOT analyzed, linted, or formatted by any tool.
includes = ["vendor"]

# Completely excluded from all tools (not even parsed)
excludes = [
    "vendor/",
    "assets/",
    "node_modules/",
    "tests/",
    "wp/",
    "admin/vendor/",
]

extensions = ["php"]

[formatter]
# WordPress Coding Standards: tabs for indentation
use-tabs = true
tab-width = 4
print-width = 120
single-quote = true
trailing-comma = true

# WordPress uses same-line braces for all structures
control-brace-style = "same-line"
function-brace-style = "same-line"
method-brace-style = "same-line"
closure-brace-style = "same-line"
classlike-brace-style = "same-line"

# else/elseif/catch/finally on same line as closing brace
following-clause-on-newline = false

# Space after cast operators: (int) $var
space-after-cast-unary-prefix-operators = true

# Keep concatenation operator spaced: $a . $b
space-around-concatenation-binary-operator = true

# Sort and separate use statements
sort-uses = true
separate-use-types = true

# Keep trailing close tag removed (WordPress standard for PHP-only files)
remove-trailing-close-tag = true

[linter]
excludes = ["tests/", "admin/vendor/"]
# Baseline file tracks existing issues so CI passes without regressions.
# New code violations will still be caught. Regenerate with:
#   ./vendor/bin/mago lint --generate-baseline --baseline linter-baseline.toml
baseline = "linter-baseline.toml"

[linter.rules]
# --- Rules disabled for WordPress compatibility ---

# WordPress uses class-component.php file naming, not ClassName.php
file-name = { enabled = false }

# WordPress does not use declare(strict_types=1)
strict-types = { enabled = false }

# WordPress uses Underscored_Class_Names, not CamelCase
class-name = { enabled = false }

# WordPress APIs rely heavily on positional string/boolean arguments
literal-named-argument = { enabled = false }

# WordPress uses isset() extensively for superglobals and option checks
no-isset = { enabled = false }

# WordPress relies on the global keyword (e.g. $wpdb, $wp_filesystem)
no-global = { enabled = false }

# WordPress coding standards use array() syntax, not short []
array-style = { enabled = false }

# WordPress uses else clauses as standard practice
no-else-clause = { enabled = false }

# WordPress allows single-statement blocks without braces in some contexts
block-statement = { enabled = false }

# WordPress uses @-suppressed errors in some contexts (e.g. file ops)
no-error-control-operator = { enabled = false }

# WordPress uses empty() checks extensively
no-empty = { enabled = false }

# WordPress uses assignments in conditions (e.g. while loops with $wpdb)
no-assign-in-condition = { enabled = false }

# Relaxed thresholds for WordPress plugin complexity
cyclomatic-complexity = { enabled = false }
excessive-parameter-list = { enabled = false }
excessive-nesting = { enabled = false }
halstead = { enabled = false }
kan-defect = { enabled = false }
too-many-methods = { enabled = false }
too-many-properties = { enabled = false }

# Formatting-only issues handled by the formatter
no-trailing-space = { enabled = false }
braced-string-interpolation = { enabled = false }

# WordPress commonly has multiple classes per file in some cases
single-class-per-file = { enabled = false }

[analyzer]
excludes = ["tests/", "admin/vendor/"]
